<!-- chat/templates/chat/room.html -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Chat Room</title>
</head>
<body>
	<ul id="messages"></ul>
    <form id="form" action="">
		<input id="name" autocomplete="off" /><input id="input" autocomplete="off" /><br>
		<button id='move'>MOVE</button><button id='create' >CREATE</button><button id='join' >JOIN</button><button id='leave' >LEAVE</button><button id='ready' >READY</button>
	</form>
    <script>
		const socket = io('http://localhost:8001/api/pong', {
			transports: ['websocket']
		});

		const name = document.getElementById('name');
		const form = document.getElementById('form');
		const input = document.getElementById('input');
		const messages = document.getElementById('messages');
		const join_room = document.getElementById('join');
		const leave_room = document.getElementById('leave');
		const ready = document.getElementById('ready');
		const create = document.getElementById('create');
		const move = document.getElementById('move');

	  
		window.addEventListener('beforeunload', (e) => {
			socket.disconnect();
		});

        chatSocket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            document.querySelector('#chat-log').value += (data.message + '\n');
        };

		join_room.addEventListener('click', (e) => {
			e.preventDefault();
			if (input.value) {
				const message = {'pid': 1, 'room': "hello world!"};
				socket.emit('join_room', message);
			}
		});

		leave_room.addEventListener('click', (e) => {
			e.preventDefault();
			if (input.value) {
				const message = {'pid': 1, 'room': "hello world!"};
				socket.emit('leave_room', message);
			}
		});

		move.addEventListener('click', (e) => {
			e.preventDefault();
			const message = {'dir': 1};
			socket.emit('move_paddle', message);
		});



		create.addEventListener('click', (e) => {
			e.preventDefault();
			if (input.value) {
				const message = {'pid': 1, 'room': input.value, 'type': 'pong'};
				socket.emit('create_room', message);
			}
		});

		ready.addEventListener('click', (e) => {
			e.preventDefault();
			if (input.value) {
				const message = {
					'ready': true};
				socket.emit('ready', message);
			}
		});
	  
		socket.on('message', (msg) => {
		  const item = document.createElement('li');
		  item.textContent = JSON.stringify(msg);
		  messages.appendChild(item);
		  window.scrollTo(0, document.body.scrollHeight);
		});
    </script>
</body>
</html>